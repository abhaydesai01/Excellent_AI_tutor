[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "20"

# Proxy all API requests to EC2 backend
# Replace YOUR_EC2_DOMAIN with your actual EC2 domain/IP
[[redirects]]
  from = "/api/auth/callback/*"
  to = "https://YOUR_EC2_DOMAIN/api/auth/callback/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/api/auth/session"
  to = "https://YOUR_EC2_DOMAIN/api/auth/session"
  status = 200
  force = true

[[redirects]]
  from = "/api/auth/csrf"
  to = "https://YOUR_EC2_DOMAIN/api/auth/csrf"
  status = 200
  force = true

[[redirects]]
  from = "/api/auth/providers"
  to = "https://YOUR_EC2_DOMAIN/api/auth/providers"
  status = 200
  force = true

[[redirects]]
  from = "/api/auth/signin"
  to = "https://YOUR_EC2_DOMAIN/api/auth/signin"
  status = 200
  force = true

[[redirects]]
  from = "/api/auth/signout"
  to = "https://YOUR_EC2_DOMAIN/api/auth/signout"
  status = 200
  force = true

[[redirects]]
  from = "/api/*"
  to = "https://YOUR_EC2_DOMAIN/api/:splat"
  status = 200
  force = true

# SPA fallback
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
